<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport"  content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Exercici PLA3_s5.D: Creació de document JSON amb un llistat de cotxes.</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"  >
</head>
<body>
  <div class="jumbotron">
    <h1>
      <i class="fa fa-clipboard"></i> Exercici PLA3_s5.D: Creació de document JSON amb un llistat de cotxes.
    </h1>
  </div>
  <div class="container-fluid">
    <div class="row" style="min-height:600px;">
        <div  id="modelBox" class="col-md-4">
        <h3>Marca</h3>
        <select class="form-control">
          <option value="">-- Escull una marca --</option>
        </select>
        </div>
        <div id="carsBox" class="col-md-8">
        <h3>Cotxes</h3>
        <table class="table">
          <thead><tr></tr></thead>
          <tbody></tbody>
        </table>
        </div>
    </div>
  </div>
  
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <script type="text/javascript">
  var txtJSON = `{
		"picotxes": {
		"cotxe": [
			{
				"marca": "Renault",
				"model": "Clio",
				"any": "2014-01-28",
				"cilindrada": "2000",
				"color": "Negre"
			},
			{
				"marca": "Alfa Romeo",
				"model": "165",
				"any": "2014-01-28",
				"cilindrada": "2000",
				"color": "Verd"
			},
			{
				"marca": "Seat",
				"model": "Ibiza",
				"any": "2014-01-28",
				"cilindrada": "1900",
				"color": "Groc"
			},
			{
				"marca": "Renault",
				"model": "Megane",
				"any": "2014-01-28",
				"cilindrada": "2000",
				"color": "Gris"
			},
			{
				"marca": "Citroën",
				"model": "Picasso",
				"any": "2014-01-28",
				"cilindrada": "2000",
				"color": "Gris"
			},
			{
				"marca": "Audi",
				"model": "Q1",
				"any": "2014-01-28",
				"cilindrada": "2500",
				"color": "Vermell"
			}
		]
	}
}`

var objCotxes = JSON.parse(txtJSON);
console.log(objCotxes.picotxes.cotxe.length);
console.log(objCotxes.picotxes.cotxe[0].marca);
var marques = [];
for (var i=0 ; i<objCotxes.picotxes.cotxe.length; i++){

marques[i]=objCotxes.picotxes.cotxe[i].marca;

}
Array.prototype.unique=function(a){
	  return function(){return this.filter(a)}}(function(a,b,c){return c.indexOf(a,b+1)<0
	});
	  
	  console.log( marques.unique() );
	  for (var i=0 ; i<marques.unique().length; i++){
		  document.getElementsByTagName("select")[0].innerHTML += "<option value=\"" + marques.unique()[i] + "\">" + marques.unique()[i] + "</option>";

		  }

	 
	  
	/*   for(key in objCotxes.picotxes.cotxe[0]){
			document.querySelector("table>thead>tr").innerHTML+="<th>"+key+"</th>";
		//	document.querySelector("table>tbody").innerHTML+="<td>"+
			//objCotxes.picotxes.cotxe[key] + "</td>";
			}  */
	  
	  for (var i=0 ; i<objCotxes.picotxes.cotxe.length; i++){
			if(i==0){
				 for(key in objCotxes.picotxes.cotxe[0]){
						document.querySelector("table>thead>tr").innerHTML+="<th>"+key+"</th>";
						//document.querySelector("table tbody").innerHTML+="<td>"+
					//	objCotxes.picotxes.cotxe[key] + "</td>";
						} 
			} 
			 var cadena="<tr>";
			for(key in objCotxes.picotxes.cotxe[i]){
			cadena+="<td>"+objCotxes.picotxes.cotxe[i][key]+"</td>";
			}
			cadena+="</tr>";
			document.querySelector("table tbody").innerHTML+=cadena;
			}
			
			 document.getElementsByTagName("select")[0].onchange=function(){
					var valortriat = document.getElementsByTagName("select")[0].value;
					console.log(valortriat);
				    if (valortriat == "") {
				    	location.reload();
				    } else {
					document.querySelector("table tbody").innerHTML="";
					for (var i=0 ; i<objCotxes.picotxes.cotxe.length; i++){
						 if (objCotxes.picotxes.cotxe[i].marca == valortriat){
						 var cadena="<tr>";
						for(key in objCotxes.picotxes.cotxe[i]){
						cadena+="<td>"+objCotxes.picotxes.cotxe[i][key]+"</td>";
						}
						cadena+="</tr>";
						document.querySelector("table tbody").innerHTML+=cadena;
						 }
						}
				    }
					
					
					
					
					
					
					}
			 
			
			
  </script>
  </body>
  </html>